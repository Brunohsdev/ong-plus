<div class="modal-container">
  <div class="modal-header bg-primary text-white sticky-top">
    <h2 class="modal-title">Editar Perfil</h2>
    <button type="button" class="btn-close btn-close-white" (click)="onCancel()" aria-label="Close"></button>
  </div>

  <div class="modal-body p-4">
    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="needs-validation" novalidate>
      <!-- Foto de perfil -->
      <div class="text-center mb-4">
        <div class="profile-photo-container mx-auto">
          <img [src]="previewImage || 'assets/images/default-avatar.png'"
               class="profile-photo"
               alt="Foto atual">
          <label for="photoUpload" class="upload-btn">
            <i class="bi bi-camera-fill"></i>
            Alterar
          </label>
          <input id="photoUpload" type="file"
                 (change)="onFileSelected($event)"
                 accept="image/*"
                 class="d-none">
        </div>
      </div>

      <!-- Alertas -->
      <div *ngIf="mensagemErro" class="alert alert-danger">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ mensagemErro }}
      </div>
      <div *ngIf="mensagemSucesso" class="alert alert-success">
        <i class="bi bi-check-circle-fill me-2"></i>{{ mensagemSucesso }}
      </div>

      <!-- Dados básicos -->
      <div class="row g-3">
        <div class="col-md-12">
          <label for="nome" class="form-label">Nome</label>
          <input type="text"
                 class="form-control"
                 id="nome"
                 formControlName="nome"
                 [ngClass]="{ 'is-invalid': submitted && profileForm.get('nome')?.errors }">
         <div class="invalid-feedback" *ngIf="submitted && profileForm.get('nome')?.errors?.['required']">
  Nome é obrigatório
</div>
        </div>

        <div class="col-md-6">
          <label for="email" class="form-label">Email</label>
          <input type="email"
                 class="form-control"
                 id="email"
                 formControlName="email"
                 [ngClass]="{ 'is-invalid': submitted && profileForm.get('email')?.errors }">
         <div class="invalid-feedback" *ngIf="submitted && profileForm.get('email')?.errors?.['required']">
  Email é obrigatório
</div>

<div class="invalid-feedback" *ngIf="submitted && profileForm.get('email')?.errors?.['email']">
  Email inválido
</div>
        </div>

        <div class="col-md-6">
          <label for="telefone" class="form-label">Telefone</label>
          <input type="text"
                 class="form-control"
                 id="telefone"
                 formControlName="telefone"
                 mask="(00) 00000-0000">
        </div>
      </div>

      <!-- Endereço -->
      <div class="section-title mt-4 mb-3">
        <i class="bi bi-geo-alt-fill me-2"></i>
        <h3 class="d-inline-block">Endereço</h3>
      </div>

      <div class="row g-3">
        <div class="col-md-8">
          <label for="rua" class="form-label">Rua</label>
          <input type="text"
                 class="form-control"
                 id="rua"
                 formControlName="rua">
        </div>

        <div class="col-md-4">
          <label for="numero" class="form-label">Número</label>
          <input type="text"
                 class="form-control"
                 id="numero"
                 formControlName="numero">
        </div>

        <div class="col-12">
          <label for="complemento" class="form-label">Complemento</label>
          <input type="text"
                 class="form-control"
                 id="complemento"
                 formControlName="complemento">
        </div>

        <div class="col-md-6">
          <label for="cidade" class="form-label">Cidade</label>
          <input type="text"
                 class="form-control"
                 id="cidade"
                 formControlName="cidade">
        </div>

        <div class="col-md-2">
          <label for="estado" class="form-label">Estado</label>
          <input type="text"
                 class="form-control"
                 id="estado"
                 formControlName="estado"
                 mask="SS"
                 [dropSpecialCharacters]="false"
                 maxlength="2">
        </div>

        <div class="col-md-4">
          <label for="cep" class="form-label">CEP</label>
          <input type="text"
                 class="form-control"
                 id="cep"
                 formControlName="cep"
                 mask="00000-000">
        </div>
      </div>

      <!-- Seção específica para ONGs -->
      <ng-container *ngIf="isOng()">
        <div class="section-title mt-4 mb-3">
          <i class="bi bi-building me-2"></i>
          <h3 class="d-inline-block">Informações da ONG</h3>
        </div>

        <div class="row g-3">
          <div class="col-md-12">
            <label for="cnpj" class="form-label">CNPJ</label>
            <input type="text"
                   class="form-control"
                   id="cnpj"
                   formControlName="cnpj"
                   mask="00.000.000/0000-00"
                   [ngClass]="{ 'is-invalid': submitted && profileForm.get('cnpj')?.errors }">
            <div class="invalid-feedback" *ngIf="submitted && profileForm.get('cnpj')?.errors?.['required']">
              CNPJ é obrigatório
            </div>
          </div>

          <div class="col-12">
            <label for="descricao" class="form-label">Descrição</label>
            <textarea class="form-control"
                      id="descricao"
                      formControlName="descricao"
                      rows="4"
                      [ngClass]="{ 'is-invalid': submitted && profileForm.get('descricao')?.errors }"></textarea>
            <div class="invalid-feedback" *ngIf="submitted && profileForm.get('descricao')?.errors?.['descricao']">
  Descrição inválida inválido
</div>
          </div>

          <div class="col-12">
            <label for="site" class="form-label">Site</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-globe"></i></span>
              <input type="url"
                     class="form-control"
                     id="site"
                     formControlName="site"
                     placeholder="https://">
            </div>
          </div>
        </div>

        <!-- Áreas de Atuação -->
        <div class="section-title mt-4 mb-3">
          <i class="bi bi-tags-fill me-2"></i>
          <h3 class="d-inline-block">Áreas de Atuação</h3>
        </div>

        <div class="row g-3">
          <div class="col-md-8">
            <label class="form-label">Adicionar Área</label>
            <select class="form-select" [(ngModel)]="selectedArea" [ngModelOptions]="{standalone: true}">
              <option value="">Selecione uma área</option>
              <option *ngFor="let area of areasAtuacaoOptions" [value]="area">{{ area }}</option>
            </select>
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button type="button"
                    class="btn btn-outline-primary w-100"
                    (click)="addAreaAtuacao(selectedArea)"
                    [disabled]="!selectedArea">
              <i class="bi bi-plus-lg"></i> Adicionar
            </button>
          </div>

          <div class="col-12">
            <div class="chips-container">
              <span class="badge bg-primary me-2 mb-2"
                    *ngFor="let area of areasAtuacaoArray.controls; let i = index">
                {{ area.value }}
                <button type="button"
                        class="btn-close btn-close-white ms-2"
                        (click)="removeAreaAtuacao(i)"></button>
              </span>
            </div>
          </div>
        </div>

        <!-- Redes Sociais -->
        <div class="section-title mt-4 mb-3">
          <i class="bi bi-share-fill me-2"></i>
          <h3 class="d-inline-block">Redes Sociais</h3>
        </div>

        <div class="row g-3">
          <div class="col-md-6">
            <label for="facebook" class="form-label">Facebook</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-facebook"></i></span>
              <input type="url"
                     class="form-control"
                     id="facebook"
                     formControlName="facebook"
                     placeholder="https://facebook.com/suaong">
            </div>
          </div>

          <div class="col-md-6">
            <label for="instagram" class="form-label">Instagram</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-instagram"></i></span>
              <input type="url"
                     class="form-control"
                     id="instagram"
                     formControlName="instagram"
                     placeholder="https://instagram.com/suaong">
            </div>
          </div>

          <div class="col-md-6">
            <label for="twitter" class="form-label">Twitter</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-twitter"></i></span>
              <input type="url"
                     class="form-control"
                     id="twitter"
                     formControlName="twitter"
                     placeholder="https://twitter.com/suaong">
            </div>
          </div>

          <div class="col-md-6">
            <label for="linkedin" class="form-label">LinkedIn</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-linkedin"></i></span>
              <input type="url"
                     class="form-control"
                     id="linkedin"
                     formControlName="linkedin"
                     placeholder="https://linkedin.com/company/suaong">
            </div>
          </div>
        </div>
      </ng-container>

      <div class="modal-footer border-top-0 pt-4">
        <button type="button"
                class="btn btn-outline-secondary"
                (click)="onCancel()">
          Cancelar
        </button>
        <button type="submit"
                class="btn btn-primary"
                [disabled]="isSubmitting">
          <span *ngIf="!isSubmitting">Salvar Alterações</span>
          <span *ngIf="isSubmitting">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Salvando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
